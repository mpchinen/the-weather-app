# .azure-pipelines.yml
trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: BuildAndDeploy
    displayName: Build & Deploy to Azure Web App
    jobs:
      - job: Build
        displayName: Build Node App
        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: '22.x'
            displayName: 'Use Node 22'
          - script: |
              cd src
              npm ci --omit=dev
            displayName: 'Install dependencies'
          - script: npm run build || echo "No build step, continuing"
            displayName: 'Optional build'

      - job: Deploy
        displayName: Deploy to Azure App Service
        dependsOn: Build
        steps:
          - task: AzureWebApp@1
            displayName: 'Deploy to Web App'
            inputs:
              azureSubscription: 'sc-azure-rm-weatherapp'   # nombre de tu Service Connection
              appType: 'webAppLinux'
              appName: 'the-weather-app-demo'              # ej: the-weather-app-demo
              package: '$(System.DefaultWorkingDirectory)'  # despliegue como c√≥digo desde el workspace